<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://ultraq.net/thymeleaf/layout"
	layout:decorate="~{myPages/sideBar/sideBar}">

<head>
<meta charset="UTF-8">
<!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API -->
<script
	src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<!-- <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=235765131723c6d6cee12c6f95e9a46a&libraries=services"></script> -->
<!-- <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=235765131723c6d6cee12c6f95e9a46"></script> -->
<style>
.errPlaceHolder::placeholder {
	color: red;
}
</style>
</head>

<body>
	<div layout:fragment="myContent">
		<div class="wrapper">
			<section id="page-content" class="page-wrapper section">
				<div class="about-section mb-80">
				<div class="container">
					<div class="message-box box-shadow white-bg"
						style="height: 750px; width: 80%">
						<!--â–¶ ìš°ë¦¬ë™ë„¤ select -->
						<div class="row" id="myAreaNow">
							<div class="section-title text-start ">
								<h4 class="blog-section-title border-left mb-30">ìš°ë¦¬ ë™ë„¤</h4>
								<h4 th:if="${userInfo.dealArea!=null}">
									ì§€ê¸ˆ ìš°ë¦¬ ë™ë„¤ëŠ” <span style="font-weight: bold;" class="myArea"
										th:text="${userInfo.dealArea}"></span> ì…ë‹ˆë‹¤.
								</h4>
								<h4 th:if="${userInfo.dealArea == null}">ìš°ë¦¬ë™ë„¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš” :D</h4>
							</div>
							<div class="mt-20"></div>
						</div>
						<hr>
						<div class="row mb-80" id="setMyArea">
							<div class="section-title text-start ">
								<h4 class="blog-section-title border-left mb-30">ìš°ë¦¬ ë™ë„¤ ì„¤ì •í•˜ê¸°</h4>
								<p>ğŸ“Œ ìš°ë¦¬ë™ë„¤ ì„¤ì •ì‹œ ì£¼ì†Œë„ í•¨ê»˜ ë³€ê²½ë©ë‹ˆë‹¤.</p>
								<br>
								<table>
									<tbody>
										<tr>
											<th><label for="addr">ì£¼ì†Œ</label></th>
											<td><input type="text" id="addr" name="addr"
												placeholder="ì£¼ì†Œ ì…ë ¥ì„ ìœ„í•´ í´ë¦­í•´ì£¼ì„¸ìš”." readonly="readonly"
												onclick="findAddr()"></td>
										</tr>
										<tr>
											<th><label for="dealArea">ìš°ë¦¬ë™ë„¤</label></th>
											<td><input type="text" id="dealArea" name="dealArea"
												placeholder="ì…ë ¥í•˜ì‹  ì£¼ì†Œì˜ êµ¬ë¡œ ìë™ ì„¤ì •ë©ë‹ˆë‹¤." readonly="readonly">
											</td>
										</tr>
									</tbody>
								</table>
							</div>
							<div class="mt-20">
								<button class="submit-btn-1 btn-hover-1" type="button"
									onclick="checkInfo()">ì„¤ì •í•˜ê¸°</button>
							</div>
						</div>
					</div>
				</div>
				</div>
			</section>
		</div>
		<script>
			// ==============================================================
			// â¤ï¸ ì£¼ì†Œ/ê±°ë˜ì§€ì—­ ì„¤ì • api
			function findAddr() {
				new daum.Postcode(
						{
							oncomplete : function(data) {
								let road = data.roadAddress; // ë„ë¡œëª… ì£¼ì†Œ
								let jibun = data.jibunAddress; // ì§€ë²ˆ ì£¼ì†Œ

								if ((road.substring(0, 2) || jibun.substring(0,
										2)) != 'ëŒ€êµ¬') {
									$('#addr').attr("placeholder",
											"ëŒ€êµ¬ê´‘ì—­ì‹œ ì†Œì¬ì˜ ì£¼ì†Œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” :D")
											.addClass("errPlaceHolder").val("")
											.focus();
								} else {
									if ((road !== '') || (jibun !== '')) {
										$("#addr").val(
												data.sido + " " + data.sigungu
														+ " " + data.bname);
										$("#dealArea").val(data.sigungu);
									}
								}
							}
						}).open();
			}
			
			// ==============================================================
			// â¤ï¸ ajax ìœ íš¨ì„± í™•ì¸
			function checkInfo() {
				let addr = $("#addr").val()
				let Gu = $("#dealArea").val();

				if (addr != "") {
					let confirmMsg = confirm("ìš°ë¦¬ ë™ë„¤ë¥¼ " + Gu + "(ìœ¼)ë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
					if (confirmMsg) {
						myAreaSetAjax(addr, Gu);
					}
				} else {
					alert("ì„¤ì •í•  ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” :D");
					$("#addr").focus();
					return false;
				}

			}
			
			// ==============================================================
			// â¤ï¸ ì£¼ì†Œ/ê±°ë˜ì§€ì—­ ë³€ê²½ Ajax
			function myAreaSetAjax(addr, Gu) {
				let memVO = {
					addr : addr,
					dealArea : Gu
				};

				$.ajax({
					url : "/my/myAreaSetAjax",
					type : 'post',
					data : JSON.stringify(memVO),
					dataType : 'text',
					contentType : 'application/json; charset = utf-8',
					success : function(result) {
						afterAjax(result, memVO)
					},
					error : function(err) {
						console.log(err);
					}
				})
			}
			
			// ==============================================================
			// â¤ï¸ ì£¼ì†Œ/ê±°ë˜ì§€ì—­ í™”ë©´ì—ì„œ ë³€ê²½
			function afterAjax(result, memVO) {
				console.log(memVO.dealArea)
				if (result == "success") {
					alert("[ìš°ë¦¬ë™ë„¤ ì„¤ì • ì™„ë£Œ] ìš°ë¦¬ë™ë„¤ë¥¼ " + memVO.dealArea
							+ "(ìœ¼)ë¡œ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤ :D");
					$("#addr").val("");
					$("#dealArea").val("");

					$(".myArea").text(memVO.dealArea);
				} else {
					alert("[ìš°ë¦¬ë™ë„¤ ì„¤ì • ì‹¤íŒ¨] ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.")
				}
			}
		</script>
	</div>

</body>

</html>