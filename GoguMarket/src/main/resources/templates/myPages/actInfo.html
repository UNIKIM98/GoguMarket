<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://ultraq.net/thymeleaf/layout"
	layout:decorate="~{myPages/sideBar/sideBar}">

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<style>
		.dropbtn {
			padding: 16px;
			font-size: 16px;
			border: none;
			cursor: pointer;
		}

		.dropdown {
			position: relative;
			display: inline-block;
		}

		.dropdown-content {
			display: none;
			position: absolute;
			min-width: 100px;
			overflow: auto;
			box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
		}

		.dropdown-content a {
			color: black;
			padding: 12px 16px;
			text-decoration: none;
			display: block;
		}

		.dropdown a:hover {
			background-color: #f1f1f1
		}

		.show {
			display: block;
		}
	</style>

	<script>
		//▶ 전체 정보 가져오는 아작스(대표계좌, 계좌 전체 목록)
		$.ajax({
			url: "/actInfoAjax",
			type: 'get',
			dataType: 'json',
			contentType: 'application/json; charset = utf-8',
			success: function (result) {
				makeMemAct(result.memAct); //→ 대표계좌
				makeActList(result.actList); //→ 계좌 전체 목록 
			},
			error: function (err) {
				console.log(err);
			}
		})

		//▶ 계좌 전체 목록
		function makeActList(actList){
							//↑ actList 타입 == 객체(object) (* 타입 확인하는 방법 : console.log(typeof(확인하고자 하는 것));)
			//↓ for문 돌면서 객체의 값을 하나씩 꺼내줌
			var actListIdx=0;
			for(actListIdx in actList) {
				    //↑ actListIdx == 인덱스(0,1,2, ... )
				console.log(actListIdx+"actListIdx")

			makeTbody(actList[actListIdx]); //→ actList[actListIdx] == auctList의 actListIdx번째 값
		}
		console.log(actListIdx+"나와서actListIdx")

		// # 등록된 계좌가 3개 미만이면 등록 버튼 출력
		console.log((Number)actListIdx+1)//★ 왜 안 되는지 모르겠음 ㅠㅠ
		if((actListIdx+1) < 3){
			for(let i=1 ; i< (4-(actListIdx+1)) ; i++){
				console.log(actListIdx+"actListIdx")
				console.log(i)
				$("#actListTable").children().eq(1).append(
				`
				<tr>
					<td colspan="3">
						<button onclick="goMemAct()" type = "button">계좌 추가</button>
					</td>
				</tr>
				`)
			}
		}
		}

		//▷ Tbody 만들기
		function makeTbody(act){
			$("#actListTable").children().eq(1).append(
				`
				<tr>
					<td>${act.bankNm}</td>
					<td>${act.actNo}</td>
					<td>
						<button onclick="delActOne(${act.bankNm}, ${act.actNo})" type = "button">삭제</button>
						<button onclick="goMemAct(${act.bankNm}, ${act.actNo})" type = "button">대표계좌로 설정</button>
					</td>
				</tr>
				`
			)
		}

		//▷ 전체 계좌에서 한 개 삭제
		function delActOne(bankNm, actNo){
			console.log(bankNm); //★ 왜 얘만 HTMLCollection ???
			console.log("actNo"+actNo);
		}

		//▷ 대표계좌로 설정하기
		function goMemAct(bankNm, actNo){
			console.log("bankNm"+bankNm);
			console.log("actNo"+actNo);
		}

		//▶ 대표계좌 
		//▷ 대표계좌 그리기
		function makeMemAct(result) {
			// # 대표계좌 없을 때(== BankNm이 Nothing일 때) : 대표계좌 등록하라는 문구 출력
			if (result.bankNm == "Nothing") {
				$("#actMemSection").children().eq(1).append(
					$("<p>").text("대표계좌를 등록해주세요 :D").css('font-size', 'medium'))

				//# 대표계좌 있을 때 : 대표계좌 정보 출력
			} else {
				$("#actMemSection").children().eq(1).html(
					`
				<img src="attech/222.jpg" alt="" style="width: 60px; height: 60px; border-radius: 70%; overflow: hidden;">
				<span class="ml-20" style="width: 25%; font-size: large;">${result.bankNm}</span> 
				<span class="ml-20" style="width: 25%; font-size: large;">${result.actNo}</span>
				<div class="dropdown">
					<button onclick="myFunction()" class="dropbtn">Dropdown</button>
					<div id="myDropdown" class="dropdown-content">
						<a onclick="delAct()">삭제</a>
					</div>
				</div>
				`
				)
			}
		}

		//▷ 대표계좌 드롭다운 버튼 : http://www.w3bai.com/ko/howto/howto_js_dropdown.html 참고
		function myFunction() {
			document.getElementById("myDropdown").classList.toggle("show");

		}
		window.onclick = function (event) {
			if (!event.target.matches('.dropbtn')) {
				var dropdowns = document.getElementsByClassName("dropdown-content");
				var i;
				for (i = 0; i < dropdowns.length; i++) {
					var openDropdown = dropdowns[i];
					if (openDropdown.classList.contains('show')) {
						openDropdown.classList.remove('show');
					}
				}
			}
		}

		//▷ 대표계좌 삭제 아작스
		function delAct() {
			$.ajax({
				url: "/delActNo",
				type: 'get',
				dataType: 'json',
				contentType: 'application/json; charset = utf-8',
				success: function (result) {
					delAfter(result);
				},
				error: function (error) {
					console.log(error);
				}
			})
		}

		//▷ 대표계좌 DB 삭제 후  
		function delAfter(data) {
			if (data.result == "success") {
				alert("[대표계좌 삭제 성공] 계좌가 정상적으로 삭제되었습니다.");
				// # 대표계좌 화면에서 지우기
				$("#actMemSection").children().eq(1).children().remove();

				// # 대표계좌 등록하라는 문구 출력하기
				$("#actMemSection").children().eq(1).append(
					$("<p>").text("대표계좌를 등록해주세요 :)").css('font-size', 'medium'));
			} else {
				//# 대표계좌 삭제 실패시
				alert("[대표계좌 삭제 실패] 계좌 삭제 중 오류가 발생하였습니다.")
			}
		}
	</script>
	<script src="myPages/js/actInfo.js"></script>
</head>

<body>
	<div layout:fragment="myContent">
		<div class="wrapper">
			<section id="page-content" class="page-wrapper section">
				<div class="about-section mb-80">
					<div class="container">
						<!--▶ 대표계좌 -->
						<div class="row mb-100" id="actMemSection">
								<div class="section-title text-start ">
									<h2 class="uppercase">나의 계좌</h2>
									<hr>
									<h3 style="font-weight: bold;">대표계좌</h3>
								</div>
							<div class="mt-20"></div>
						</div>
						
						<!--▶ 전체 계좌 목록-->
						<div class="row" >
								<div class="section-title text-start mb-20">
									<hr>
									<h3 style="font-weight: bold;">계좌목록</h3>
									<p>계좌는 최대 3개까지 등록할 수 있습니다.</p>
								</div>
								<div style="text-align: center">
									<table class="table" id="actListTable">
										<thead>
											<tr>
												<th>은행명</th>
												<th>계좌번호</th>
												<th></th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
						</div>
					</div>
				</div>
			</section>

		</div>


	</div>
</body>

</html>