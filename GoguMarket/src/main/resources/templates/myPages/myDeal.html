<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://ultraq.net/thymeleaf/layout"
	layout:decorate="~{myPages/sideBar/sideBar}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div layout:fragment="myContent">
	<script th:inline="javascript">
	function gopage(page) {
		updateFrm.page.value = page;
		updateFrm.submit();
	}
	$(function(){

		const url = new URL(location.href);

		// URLSearchParams κ°μ²΄
		const urlParams = url.searchParams;

		// URLSearchParams.get()
		let tabName = urlParams.get('tabName'); 	
		
	  var firstTabEl = document.querySelector(`[data-bs-target="#${tabName}"]`)
	  var firstTab = new bootstrap.Tab(firstTabEl)

	  firstTab.show();
		
	})
	</script>
	
	<div class="wrapper">
			<section id="page-content" class="page-wrapper section">
				<div class="about-section mb-80">
				<div class="container">
					<div class="message-box box-shadow white-bg"
<!-- 						style="height: auto; width: 100%"> -->
						<!--β–¶ μ°λ¦¬λ™λ„¤ select -->
<!-- 						<div class="row" id="myAreaNow"> -->
<!-- 							<div class="section-title text-start "> -->
<!-- 								<h4 class="blog-section-title border-left mb-30">λ‚μ ν¬μΈνΈ</h4> -->
<!-- 								<div class="order-complete-content box-shadow"> -->
<!-- 												<div class="order-info p-30 mb-10"> -->
<!-- 													<ul class="order-info-list"> -->
<!-- 														<li><a class="totalP" href='javascript:void(0);' -->
<!-- 															onclick="criteriaPoint(event);">ν„μ¬ ν¬μΈνΈ</a> -->
<!-- 															<p> -->
<!-- 																μ΄ <span class="totalPTrgt" -->
<!-- 																	style="color: #C04A82; font-weight: bold;">0</span>ν¬μΈνΈ -->
<!-- 															</p></li> -->
<!-- 													</ul> -->
<!-- 												</div> -->
<!-- 												<div class="row"> -->
<!-- 													<div class="col-md-12"> -->
<!-- 														<div class="payment-details p-30"> -->
<!-- 															<h6 class="widget-title border-left mb-20" -->
<!-- 																style="display: inline-block;">ν¬μΈνΈμƒμ„Έμ •λ³΄</h6> -->
<!-- 																<h6>λ§μ΄ν¬μΈνΈ νμ΄μ§€λ΅ μ΄λ™ν•©λ‹λ‹¤</h6> -->
<!-- 																<div class="d-flex justify-content-center"> -->
<!-- 															<button class="submit-btn-1 btn-hover-1" -->
<!-- 																style="border-radius: 20px; height: 30px" -->
<!-- 																onclick="point()">λ§μ΄ν¬μΈνΈ</button> -->
<!-- 																</div> -->
<!-- 															<table class="saveTable"> -->
<!-- 															</table> -->
<!-- 														</div> -->
<!-- 													</div> -->
<!-- 												</div> -->
<!-- 											</div> -->
<!-- 								<h4 th:if="${userInfo.dealArea!=null}"> -->
<!-- 									μ§€κΈ μ°λ¦¬ λ™λ„¤λ” <span style="font-weight: bold;" class="myArea" -->
<!-- 										th:text="${userInfo.dealArea}"></span> μ…λ‹λ‹¤. -->
<!-- 								</h4> -->
<!-- 								<h4 th:if="${userInfo.dealArea == null}">μ°λ¦¬λ™λ„¤λ¥Ό μ„¤μ •ν•΄μ£Όμ„Έμ” :D</h4> -->
<!-- 							</div> -->
<!-- 							<div class="mt-20"></div> -->
<!-- 						</div> -->
<!-- 						<hr> -->
						<div class="row mb-80" id="setMyArea">
							<div class="section-title text-start ">
								<h4 class="blog-section-title border-left mb-30">μ¤‘κ³ κ±°λλ‚΄μ—­</h4>
								<p>π“ μ°λ¦¬λ™λ„¤ μ„¤μ •μ‹ μ£Όμ†λ„ ν•¨κ» λ³€κ²½λ©λ‹λ‹¤.</p>
								<br>
								<div class="single-product-tab reviews-tab">
									<ul class="nav nav-tabs mb-20">
										<li class="nav-item"><a class="nav-link active" href="#description" data-bs-toggle="tab" role="tab" data-bs-target="#description">νλ§¤μ¤‘</a></li>
										<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#soldout">νλ§¤μ™„λ£</a></li>
										<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#prchs">κµ¬λ§¤λ‚΄μ—­</a></li>
									</ul>
					
									<div class="tab-content">
										<div th:each="deal : ${dealList}" role="tabpanel" class="tab-pane active show" id="description">
											<!-- β– β– β– β– β– β– λμ¬ν•λ ¤κ³  νΌμΌλ΅ κ°μ‹ΈκΈ° -->
											<form id="updateFrm" method="post">
												<input type="hidden" name="page" value="1">
												<input type="hidden" name="tabName" value="description">
												<div class="featured-product" >
													<div class="active-featured-product slick-arrow-2" >
														<div class="media mt-30" th:if="${dealList}!=null" >
															<div class="media-left">
																<a th:href="@{/goguma/dealdetail/{dlNo}(dlNo=${deal.DL_NO})}">
																<img th:src="${deal.ATCH_NM}" alt="μ¤‘κ³  λ€ν‘ μ‚¬μ§„" style="width: 80px; height: 75px;" onerror="this.onerror=null; this.src='/img/logo/001.png'" /></a>
																
															</div>
															<div class="media-body">
																<div class="clearfix">
																	<div class="name-commenter f-left">
																		<h6 class="media-heading">
																			<a th:text=${deal.DL_TTL}>νƒ€μ΄ν‹€μλ¦¬</a>
																		</h6>
																		<p class="mb-10" th:text="${#dates.format(deal.DL_YMD, 'yyyy/MM/dd')}"></p>
																	</div>
																	<div class="f-right">
																		<ul class="reply-delate">
																			<li><a th:text="${#numbers.formatInteger(deal.DL_PRC, 3, 'COMMA') + 'μ›'}" th:if="${deal.DL_PRC} != 0">κ°€κ²©</a></li>
																			<li style="color:#C04A82;"><a th:if="${deal.DL_PRC} == 0">λ¬΄λ£λ‚λ”</a></li>
									
																		</ul>
																	</div>
																</div>
																<ul class="action-button">
																	<input type="hidden" name="ntslId" id="ntslId" th:value="${session.userId}">
																	<input type="hidden" name="dlNo" id="dlNo" th:value="${deal.DL_NO}">
																		<input
																				class="submit-btn-1 mt-30 btn-hover-1" type="submit"
																				id="btnSave" role="button" value="λμ–΄μ¬λ¦¬κΈ°" style="border-radius: 20px;">
																</ul>
															</div>
														</div>
													</div>
												</div>
																<!-- νμ΄μ§€λ²νΈκ΄€λ ¨ -->
																<div align="center">
																	<a
																		th:each="num : *{#numbers.sequence(paging.startPage, paging.endPage)}"
																		th:href="|javascript:gopage(${num})|"
																		th:class="${paging.page}==${num} ? 'active'"> [[${num}]]</a>
																</div>
											</form>
										</div>
											<div role="tabpanel" class="tab-pane" id="soldout">
												<form id="" method="post">
													<input type="hidden" name="page" value="1">
													<input type="hidden" name="tabName" value="soldout">
													<!-- reviews-tab-desc -->
													<div class="featured-product" >
														<div class="active-featured-product slick-arrow-2" >
															<div th:if="${#lists.isEmpty(dealsold)}" th:text="'νλ§¤μ™„λ£ λ‚΄μ—­μ΄ μ—†μµλ‹λ‹¤'" style="text-align:center;"></div>
															<div class="product-item" th:if="${dealsold}!=null" th:each="deal : ${dealsold}">
																<div class="product-img">
																	<div style="text-align : center;">
																	<a th:href="@{/goguma/dealdetail/{dlNo}(dlNo=${deal.DL_NO})}">
																		<img th:src="${deal.ATCH_NM}" alt="μ¤‘κ³  λ€ν‘ μ‚¬μ§„" onerror="this.onerror=null; this.src='/img/logo/001.png'" style="width:50%;"/></a>
																		</div>
																</div>
																<div class="product-info">
																	<h6 class="product-title"
																		th:text="${deal.DL_TTL}">μƒν’λ…</h6>
																	<h3 class="pro-price" th:text="${#numbers.formatInteger(deal.DL_PRC, 3, 'COMMA') + 'μ›'}" th:if="${deal.DL_PRC} != 0">κ°€κ²©</h3>
																	<h3 style="color:#C04A82;" class="pro-price"th:if="${deal.DL_PRC} == 0">λ¬΄λ£λ‚λ”</h3>
																</div>
															</div>
														</div>
													</div>
													<!-- νμ΄μ§€λ²νΈκ΄€λ ¨ -->
																<div align="center">
																	<a
																		th:each="num : *{#numbers.sequence(paging.startPage, paging.endPage)}"
																		th:href="|javascript:gopage(${num})|"
																		th:class="${paging.page}==${num} ? 'active'"> [[${num}]]</a>
																</div>
												</form>
											</div>
											<div role="tabpanel" class="tab-pane" id="prchs">
												<!-- reviews-tab-desc -->
												<div class="featured-product" >
													<div class="active-featured-product slick-arrow-2" >
														<div  th:if="${#lists.isEmpty(buyList)}" th:text="'κµ¬λ§¤μ™„λ£ λ‚΄μ—­μ΄ μ—†μµλ‹λ‹¤'"  style="text-align:center;"></div>
														<div class="product-item" th:if="${buyList}!=null" th:each="deal : ${buyList}">
															<div class="product-img" style="height:150px">
																<a th:href="@{/goguma/dealdetail/{dlNo}(dlNo=${deal.DL_NO})}">
																	<img th:src="${deal.ATCH_NM}" alt="μ¤‘κ³  λ€ν‘ μ‚¬μ§„"/></a>
															</div>
															<div class="product-info">
																<h6 class="product-title"
																	th:text="${deal.DL_TTL}">μƒν’λ…</h6>
																<h3 class="pro-price" th:text="${deal.DL_PRC}">κ°€κ²©</h3>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
							</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>

	
		
		<script th:inline="javascript">
		// λ§μ΄ν¬μΈνΈ νμ΄μ§€λ΅ κ°€λ” λ²„νΌ ν•¨μ
		function point() {
			location.href = `/my/myPoint`
		}
		
		//==============================================================================
		// β¤οΈ ν¬μΈνΈ ν† νƒ κµ¬ν•κΈ° μ„ν• : μ „μ—­λ³€μ μ„ μ–Έ
		var pointInfo; // μ „μ²΄ ν¬μΈνΈ μ •λ³΄
   		var pointTotal = 0; // μ „μ²΄ μ΄ν•©
   		
   		$(function(){
   			
   		})
   		
     	// β¤οΈ ν¬μΈνΈ μ „μ²΄ κ°€μ Έμ¤κΈ° Ajax
	       function myPointAjax(){
	    	   $.ajax({
	    		   url : '/my/myPointAjax',
	    		   type : 'get',
	    		   success : function(result){
	    			   pointInfo = result;
	    			   pointInfo.forEach((point, idx)=>{
								console.log(point)
								pointTotal += point.point		
	    	   			})
	    	   			console.log(pointTotal);
	    			   $(".totalPTrgt").text(pointTotal);
	    		   },
	    		   error : function(err){
	    			   console.log(err);
	    		   }
	    	   })
	       }
  
		//β… DOM κ·Έλ¦¬λ©΄μ„ μ‹¤ν–‰λλ” ν•¨μ (== document.onload())
		$(function() {
			console.log("=================");
			myPointAjax(); 
			$("#btnSave").on("click", function() {
				submitForm();
			});
		});
		
		//π“	 κ³µν†µμΌλ΅ μ“°μΌ λ³€μ μ„ μ–Έ(μ „μ—­λ³€μ var)
		var isSubmitOk = true;
		
		function submitForm() {
				//submit μ „ μ²΄ν¬ν•κΈ° : μ²΄ν¬ν• κ±°μ‡μ? μ•„ μ“Έ ν¬μΈνΈκ°€ μλ”μ§€ λ¬Όμ–΄λ³΄λ©΄ μΆ‹μ„λ“―
				if (submitCheck()) {
					var formData = new FormData($("#updateFrm")[0]);
				// β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β–  μ•„μ‘μ¤λ¶€λ¶„ β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– β– 
				$.ajax({
					url : "/my/myDealSubmit",
					type : "POST",
					data : formData,
					processData : false,
					contentType : false,
					success : function(result) {
						console.log(result)
						if (result > 0 ){
							alert("[μ™„λ£]	κ²μ‹κΈ€ λμ–΄μ¬λ¦¬κΈ°κ°€ μ™„λ£λμ—μµλ‹λ‹¤ :D");
							myPointAjax();
						}else 
						{
							alert("[μ‹¤ν¨] κ²μ‹κΈ€ λμ–΄μ¬λ¦¬κΈ°λ¥Ό μ‹¤ν¨ν•μ€μµλ‹λ‹¤. :("); 
						}
					},
					error : function(err) {
						alert("[μ‹¤ν¨] κ²μ‹κΈ€ λμ–΄μ¬λ¦¬κΈ°λ¥Ό μ‹¤ν¨ν•μ€μµλ‹λ‹¤. :("); 
					}
				});
			}
		}
		
		function submitCheck() {
			// ν¬μΈνΈκ°€ 200μ΄μƒμ΄μ–΄μ•Ό λμ¬μ„ ν• μμκ²μ¬¬? : 200 λ―Έλ§μ΄λ©΄ false
					
			// ν•λ² λ„λ¥΄κ³  μ¤λ¶„λ’¤μ— λ„λ¥΄κ²ν• μμ—†λ‚­
			if ($(".totalPTrgt").text() < 200) {
				$(".totalPTrgt").focus();
				alert("[μ‹¤ν¨] λ‚¨μ€ ν¬μΈνΈλ¥Ό ν™•μΈν•΄λ³΄μ„Έμ” :(");
				isSubmitOk = false;
			}
			return isSubmitOk;
		}
		
		</script>
			</div>
	
</body>
</html>