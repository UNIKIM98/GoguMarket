<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://ultraq.net/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>ì¤‘ê³ ê±°ë˜ìƒí’ˆë“±ë¡</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">


<style>
@font-face {
	font-family: 'S-CoreDream-3Light';
	src:
		url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-3Light.woff')
		format('woff');
	font-weight: normal;
	font-style: normal;
}

* {
	font-family: 'S-CoreDream-3Light';
}

#uploadFileList {
	width: 100%;
	height: 20%;
	padding: 10px;
	/* 		border: 1px solid lightgrey; */
	/* 		border-radius: 5px; */
	margin-bottom: 30px;
}

#uploadFileList:empty:before {
	content: attr(data-placeholder);
	color: #999;
	font-size: .9em;
}

.message-box input[type=text], textarea {
	width: 70%;
}

.message-box label {
	width: 25%;
}

#dFrm span {
	color: red;
}
</style>
<script src="https://code.jquery.com/jquery-3.6.3.js"
	integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
	crossorigin="anonymous"></script>
</head>

<body>
	<div layout:fragment="content">
		<!-- Body main wrapper start -->
		<div class="wrapper">
			<!-- Start page content -->
			<section id="page-content" class="page-wrapper section">

				<!-- MESSAGE BOX SECTION START -->
				<div class="message-box-section mb-80">
					<div class="container">
						<div class="row">
							<div class="col-lg-12" style="width: 70%">
								<div class="message-box box-shadow white-bg">
									<!-- â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  ì£¼ì˜1 â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  -->
									<form id="dFrm" method="post" enctype="multipart/form-data"
										onsubmit="return false">
										<!-- â– â– â†‘ form id ìƒˆë¡œ ì§€ì •í•´ì£¼ì„¸ìš” â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  -->
										<div class="row">
											<div class="col-lg-12">
												<h4 class="blog-section-title border-left mb-30">ì¤‘ê³ ê±°ë˜ìƒí’ˆë“±ë¡</h4>
											</div>
										</div>
										<!-- â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  ì£¼ì˜2 â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  -->
										<div class="col-lg-10" id="inputFile">
											<label for="files">ìƒí’ˆì‚¬ì§„<span> *</span></label> <input
												type="file" id="files" placeholder="ì²¨ë¶€íŒŒì¼"
												multiple="multiple"> <br> <span id="fileErrMsg"></span>
											<div id="fileList">
												<div id="uploadFileList" data-placeholder='ğŸ¶ì²¨ë¶€íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤ğŸŒ³'
													class="message-box box-shadow white-bg"></div>
											</div>
										</div>
										<!-- â– â– â– â†‘ ê±´ë“œë¦¬ë©´ ì£½ìŒë¿.â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  -->
										<div class="col-lg-10 mb-10">
											<label for="cate">ì¹´í…Œê³ ë¦¬<span> *</span></label> <select
												name="cate" id="cate">
												<option value="" disabled selected>ì„ íƒ</option>
												<option th:each="ct : ${category}" th:text="${ct.commonNm}"
													th:value="${ct.commonDetailCode}"></option>
											</select> <span id="ctgryErrMsg"></span> <input type="hidden"
												name="ctgry" id="ctgry" placeholder="ì¹´í…Œê³ ë¦¬">
										</div>
										<div class="col-lg-10 ">
											<label for="dlTtl">ê¸€ì œëª©<span> *</span></label> <input
												type="text" name="dlTtl" id="dlTtl"
												placeholder="ê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.">
										</div>
										<div class="col-lg-10">
											<label for="dlCn">ìƒí’ˆì„¤ëª…<span> *</span></label>
											<textarea class="custom-textarea" name="dlCn" id="dlCn"
												placeholder="ê²Œì‹œê¸€ ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”. ë‹¨, íŒë§¤ê¸ˆì§€ ë¬¼í’ˆì€ ê²Œì‹œê°€ ì œí•œë  ìˆ˜ ìˆì–´ìš” :)"></textarea>
										</div>

										<div class="col-lg-10">
											<label for="dlPrc">ìƒí’ˆê°€ê²©<span> *</span></label> <input
												type="text" name="dlPrc" id="dlPrc" placeholder="ìƒí’ˆê°€ê²©"
												oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');">
										</div>
										<div class="col-lg-10">
											<label for="area">ê±°ë˜ì§€ì—­</label> <input type="text" name="area"
												id="area" placeholder="ê±°ë˜ì§€ì—­" />
										</div>
										<div class="col-lg-10">
											<label for="negoYn">ê°€ê²© ì œì•ˆë°›ê¸°</label> <input type="checkbox"
												name="negoYn" id="negoYn" style="margin: 0px">
										</div>
										<input type="hidden" name="stts" id="stts" value="íŒë§¤ì¤‘">
										<input type="hidden" name="ntslId" id="ntslId"
											th:value="${session.userId}"> <input
											class="submit-btn-1 mt-30 btn-hover-1" type="submit"
											id="btnSave" role="button" value="ë“±ë¡í•˜ê¸°">
									</form>
								</div>
								<!-- </form> -->
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>

		<script th:inline="javascript">
		//==============================================================================
		//âœ… DOM ê·¸ë¦¬ë©´ì„œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (== document.onload())
			$(function() {
				$("#files").on("change", function(e) {
					$("#fileErrMsg").text("")
					inputFile(e);
				});
				
				$("#cate").on("change", function(){
					$("#ctgryErrMsg").text("")
				})
				
				$("#btnSave").on("click", function() {
					submitForm();
				});
				
				console.log(sessionStorage.getItem('dealArea')+"ê±°ë˜ì§€ì—­")
				$("#area").val()
			});
		
		//==============================================================================
		//ğŸ“Œ	 ê³µí†µìœ¼ë¡œ ì“°ì¼ ë³€ìˆ˜ ì„ ì–¸(ì „ì—­ë³€ìˆ˜ var)
			var fileCount = 0; //í˜„ì¬ ì²¨ë¶€íŒŒì¼ ê°œìˆ˜
			var totalCount = 10; // ì²¨ë¶€ ê°€ëŠ¥í•œ íŒŒì¼ ê°œìˆ˜
			var fileNum = 0; //ì²¨ë¶€íŒŒì¼ ì¸ë±ìŠ¤
			var inputFileList = new Array(); // insert íŒŒì¼ ë°°ì—´
			var deleteFileList = new Array(); // delete íŒŒì¼ ë°°ì—´
			var isSubmitOk = true;

			var img_style = 'width:100px;height:100px;z-index:none'; // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ì†ì„±

		//==============================================================================
		//âœ… input ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
			function inputFile(e) {
				var files = e.target.files;
				var filesArr = Array.prototype.slice.call(files);

				if (fileCount + filesArr.length > totalCount) {
					alert('íŒŒì¼ì€ ìµœëŒ€ ' + totalCount + 'ê°œê¹Œì§€ ì—…ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
					return;
				} else {
					fileCount = fileCount + filesArr.length;
				}

				filesArr.forEach(function(f) {
					var reader = new FileReader();
					reader.onload = function(e) {
									inputFileList.push(f);
									$('#uploadFileList').append(
																`<img style=${img_style} src=${e.target.result}
																	   id=file${fileNum} onclick=fileDelete('file${fileNum}') class=m-1>`
																)
									fileNum++;
								};
					reader.readAsDataURL(f);
				});
				$("#files").val("");
			}

		//==============================================================================
		//âœ… í™”ë©´/ë°°ì—´ì—ì„œ delete ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜			
			function fileDelete(fileNum) {
				var no = fileNum.replace(/[^0-9]/g, "");
				inputFileList[no].is_delete = true;
				$('#' + fileNum).remove();
				fileCount--;
				if(fileCount==0){
					$("#fileErrMsg").text("âœ… ìƒí’ˆ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.")
					isSubmitOk = false;
				}
			}
		
		//==============================================================================
		//âœ… í™”ë©´/ë°°ì—´ì—ì„œ delete ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
			function submitForm() {
				// ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ > hidden input valueë¡œ ë„£ê¸°
				var ctgry = $("#cate option:selected").val(); 
				$("#ctgry").val(ctgry); 
				
				// ë„¤ê³ ì—¬ë¶€ > ì²´í¬ì‹œ valueë¡œ Y ì£¼ê¸°  //ë””í´íŠ¸ N(javaì—ì„œ ì²˜ë¦¬í•  ì˜ˆì •~!)
				console.log($('#negoYn'))
				if ($('#negoYn').is(":checked")) {
					console.log("checked!")
		            $('#negoYn').val("Y");
		        }
					
				$('#stts').val("íŒë§¤ì¤‘"); // ì¸ì„œíŠ¸í• ë•Œ ëŠ˜ íŒë§¤ì¤‘ìœ¼ë¡œ ë“¤ì–´ê°€ê²Œ..
				//submit ì „ ì²´í¬í•˜ê¸°
				if(submitCheck()){
				// â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  ì£¼ì˜3 â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– 
				var formData = new FormData($("#dFrm")[0]);
				// â– â– â– â†‘ ì£¼ì˜1ì—ì„œ ì§€ì •í•œ í¼ id ì ì–´ì£¼ì„¸ìš” â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– 
				
				formData.append("deleteFiles", deleteFileList);

				for (var i = 0; i < inputFileList.length; i++) {
					if (!inputFileList[i].is_delete) {
						formData.append("files", inputFileList[i]);
					}
				}
				// â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  ì£¼ì˜4 â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– 
				$.ajax({	url : "/my/dealformsubmit",
							type : "POST",
							data : formData,
							processData : false,
							contentType : false,
							success : function(result) {
								console.log(result)
									alert("[ì‘ì„± ì™„ë£Œ] \""+ result.dlTtl+"\"ê²Œì‹œê¸€ ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ :D");
									location.href = "/dealMain";
								
							},
							error : function(err){
								alert("[ì‘ì„± ì‹¤íŒ¨] ê²Œì‹œê¸€ ì‘ì„±ì„ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. :(");
							}
						});
				// â– â– â– â†‘ â‘ url â‘¡alert ë‚´ìš© â‘¢success > location.href ê²½ë¡œ ë°”ê¿”ì£¼ì„¸ìš” â– â– â– â– â– â– â– â– â– â– â– â– â– â– 
				}
			}
		//==============================================================================
		//âœ… í™”ë©´/ë°°ì—´ì—ì„œ delete ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
			function submitCheck(){
			//1. íŒŒì¼ ì—…ë¡œë“œ ì—¬ë¶€
			if(inputFileList.length==0){
				$("#fileErrMsg").text("âœ… ìƒí’ˆ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.")
				isSubmitOk = false;
			}
			
			//2. ì¹´í…Œê³ ë¦¬ ì„ íƒ ì—¬ë¶€
			else if($("#ctgry").val()==""){
				$("#ctgryErrMsg").text("âœ… ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.")
				isSubmitOk = false;
			}
			
			//3. ê¸€ì œëª© ì‘ì„± ì—¬ë¶€
			else if($("#dlTtl").val()==""){
				$("#dlTtl").focus();
				isSubmitOk = false;
			}
			
			//4. ê¸€ë‚´ìš© ì‘ì„± ì—¬ë¶€
			else if($("#dlCn").val()==""){
				$("#dlCn").focus();
				isSubmitOk = false;
			}

			//5. ìƒí’ˆê°€ê²© ì‘ì„± ì—¬ë¶€
			else if($("#dlPrc").val()==""){
			   $("#dlPrc").focus();
				isSubmitOk = false;
			}else{
				isSubmitOk = true;
			}		
			
			return isSubmitOk;			
		}
		//==============================================================================
		//âœ… (ìˆ˜ì •/ì‚­ì œì—ì„œ ì‚¬ìš©) ê¸°ì¡´ dbì—ì„œ ì‚­ì œí•  íŒŒì¼ë“¤ì„ ë°°ì—´ì— ë‹´ì•„ì„œ ë³´ë‚´ëŠ” í•¨ìˆ˜
			function deleteFile(elem) {
// 				console.log(elem.value);
// 				$(elem).parent().remove();
// 				if (!deleteFileList.includes(elem.value)) {
// 					deleteFileList.push(elem.value);
// 					}
			}
			
	</script>
	</div>
	<!-- jquery latest version -->
	<script src="js/vendor/jquery-3.6.0.min.js"></script>
	<script src="js/vendor/jquery-migrate-3.3.2.min.js"></script>
	<!-- Bootstrap framework js -->
	<script src="js/bootstrap.bundle.min.js"></script>
	<!-- jquery.nivo.slider js -->
	<script src="lib/js/jquery.nivo.slider.js"></script>
	<!-- All js plugins included in this file. -->
	<script src="js/plugins.js"></script>
	<!-- ajax-mail js -->
	<script src="js/ajax-mail.js"></script>
	<!-- Main js file that contents all jQuery plugins activation. -->
	<script src="js/main.js"></script>


</body>

</html>