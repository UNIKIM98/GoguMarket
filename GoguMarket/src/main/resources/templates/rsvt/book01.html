<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
<body>
	<div layout:fragment="content">

		<script type="text/javascript"
			src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5910303ba80aa602d476d406bd428897&libraries=services"></script>
		<!-- í˜ì´ì§•, ê²€ìƒ‰ ìë°”ìŠ¤í¬ë¦½íŠ¸ -->
		<script>
			function gopage(page) {
				frmSearch.page.value = page;
				frmSearch.submit();
			}

			function ctgryId(name) {
				console.log(name) //ì¹˜í‚¨ <- ì´ëŸ°ì‹ìœ¼ë¡œ ë‚˜ì˜´
			}
		</script>

		<!-- Start page content -->
		<div id="page-content" class="page-wrapper section">

			<!-- SHOP SECTION START -->
			<div class="shop-section mb-80">
				<div class="container">

					<!-- ì œëª© ë¶€ë¶„ -->
					<div class="row">
						<div class="col-lg-12">
							<div class="section-title text-start ">
								<h2 class="uppercase">ë™ë„¤ ì´ì›ƒë“¤ì´ ìì£¼ ê°€ëŠ” ë™ë„¤ ê°€ê²Œ</h2>
								<h6 class="mb-40">ìš°ë¦¬ë™ë„¤ ì‚¬ëŒë“¤ì´ ìì£¼ ì´ìš©í•˜ëŠ” ê°€ê²Œë¥¼ ì°¾ì•„ë³´ì„¸ìš”í˜¸ìš°</h6>
							</div>
						</div>
						<!-- hr -->
						<hr>
					</div>

					<div class="row">
						<div class="col-lg-5 order-lg-2 order-1"
							style="overflow-y: scroll; height: 800px;">
							<div class="shop-content">

								<!-- Tab Content start -->
								<div class="tab-content">
									<!-- ê²€ìƒ‰ì°½ -->
									<aside class="widget-search mb-30">

										<!-- í˜ì´ì§•ì„ ìœ„í•´ formíƒœê·¸ì— nameì¶”ê°€, hiddeníƒ€ì… inputíƒœê·¸ ì¶”ê°€ -->
										<form name="frmSearch" action="#">
											<!-- â–¼ ì¶”ê°€ëœ input -->
											<input type="hidden" name="page" value="1">
										</form>

										<!-- â–¼ inputíƒœê·¸(ê²€ìƒ‰ìš©) -->
										<form name="searchForm" id="searchForm">
											<input type="hidden" id="searchType" name="searchType"
												value="bizNm"> <input type="hidden" name="page"
												value="1"> <input type="text" id="keyword"
												name="keyword" placeholder="ì°¾ì•„ë³¼ ê°€ê²Œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!">
											<button type="submit" style="height: 55px;">
												<i class="zmdi zmdi-search"></i>
											</button>
										</form>

										<!-- ê²€ìƒ‰ì°½ ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
										<div class="mt-20">

											<ul class="blog-meta">
												<li th:each="ctgry: ${ctgry}"><a
													th:href="|javascript:ctgryId('${ctgry.commonNm}')|"
													th:text="${ctgry.commonNm}" th:name="${ctgry.commonNm}|">(ì¹´í…Œê³ ë¦¬)
												</a></li>
											</ul>

										</div>
									</aside>

									<!-- list-view -->
									<div id="list-view" class="tab-pane active show"
										role="tabpanel">
										<div class="row">
											<!-- product-item start ì´ê±° forë¬¸ ëŒë ¤ì„œ ìƒì ëª©ë¡ ì¶œë ¥í•˜ë©´ë¨ -->
											<div class="col-lg-12">
												<div class="shop-list product-item" th:each="list: ${lists}">
													<div class="product-img">
														<a th:href="@{/book0205/{bizNo}(bizNo=${list.bizNo})}">
															<img th:each="img: ${img}"
															th:if="${list.bizNo} == ${img.bizNo}"
															th:src="${img.atchNm}" alt="" />
														</a>
													</div>
													<div class="product-info">
														<div class="clearfix">
															<h6 class="product-title f-left">
																<a
																	th:href="@{/goguma/bookmain/{bizNo}(bizNo=${list.bizNo})}"
																	th:data-empid="${list.bizNo}" th:text="${list.bizNm}">
																	(ê°€ê²Œì´ë¦„) </a>
															</h6>
															<div class="pro-rating f-right">
																<a href="#"><i class="zmdi zmdi-star"></i></a> 
																<a href="#"><i class="zmdi zmdi-star"></i></a> 
																<a href="#"><i class="zmdi zmdi-star"></i></a> 
																<a href="#"><i class="zmdi zmdi-star-half"></i></a>
																<a href="#"><i class="zmdi zmdi-star-outline"></i></a>
															</div>
														</div>
														<h6 class="brand-name mb-30" th:text="${list.bizAddr}">(ì£¼ì†Œ)</h6>
														<p th:text="${list.cn}">(ê°€ê²Œ ì„¤ëª…)</p>
														<ul class="blog-meta">
															<li><a href="#" th:each="cnt: ${dgCnt}"
																th:if="${cnt.bizNo == list.bizNo}"
																th:utext="|<i class='zmdi zmdi-favorite'></i>ë‹¨ê³¨  ${cnt.dCount}|">(ë‹¨ê³¨
																	ìˆ˜)</a></li>
															<li><a href="#" th:each="rcnt: ${rwCnt}"
																th:if="${rcnt.bizNo == list.bizNo}"
																th:utext="|<i class='zmdi zmdi-comments'></i>í›„ê¸°  ${rcnt.rwCount}|">(í›„ê¸°
																	ìˆ˜)</a></li>
															<li><a href="#" th:id="${list.ctgry}"
																th:text="${list.ctgry}">ì¹´í…Œê³ ë¦¬ì´ë¦„</a></li>
														</ul>

													</div>
												</div>

											</div>
											<!-- product-item end -->

										</div>
									</div>
								</div>
								<!-- Tab Content end -->
							</div>

							<!-- ê°€ê²Œ ëª©ë¡ í˜ì´ì§• -->
							<ul class="shop-pagination box-shadow text-center ptblr-10-30">
								<li><a href="#"><i class="zmdi zmdi-chevron-left"></i></a></li>
								<li
									th:each="num: *{#numbers.sequence(pagingVO.startPage, pagingVO.endPage)}"
									th:class="${pagingVO.page}==${num} ? 'active'"><a
									th:href="|javascript:gopage(${num})|">[[${num}]]</a></li>

								<li><a href="#"><i class="zmdi zmdi-chevron-right"></i></a></li>
							</ul>

						</div>


						<!-- ì˜¤ë¥¸ìª½ì— ì§€ë„ë¥¼ ë„£ìœ¼ë©´ ë ê¹Œ..? -->
						<div class="col-lg-7 order-lg-2 order-1">
							<div class="">
								<!-- ì§€ë„ -->
								<div id="map" style="width: 100%; height: 800px;"></div>

								<!-- ì§€ë„ END -->
							</div>
						</div>

					</div>
						<a class="button f-right mt-10" href="/my/shop01"
							th:if="${session.userSe=='ROLE_USER'}"><span>ğŸ’¥ê°€ê²Œ í”„ë¡œí•„ ë§Œë“¤ê¸° </span> </a>
				</div>
			</div>
			<!-- SHOP SECTION END -->

		</div>

		<script>
		
			//ì¹´ì¹´ì˜¤ì§€ë„ API
			var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div  
			mapOption = {
				center : new kakao.maps.LatLng(35.8690334, 128.5932794), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ(ì˜ˆë‹´)
				level : 3
			// ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
			};

			// ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
			var map = new kakao.maps.Map(mapContainer, mapOption);

			// ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
			var zoomControl = new kakao.maps.ZoomControl();
			map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

			// ì£¼ì†Œ-ì¢Œí‘œ ë³€í™˜ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
			var geocoder = new kakao.maps.services.Geocoder();

			// ì£¼ì†Œë¡œ ì¢Œí‘œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
			$.ajax({
					url : "/goguma/mapApiAjax",
					type : "get",
					success : function(obj) {
						console.log("ajaxì‹œì‘í•˜ìë§ˆì========"+obj[0].bizNm+""+obj[1].bizNm)
						// ì£¼ì†Œ ëª©ë¡ì— ëŒ€í•´ ë°˜ë³µë¬¸ì„ ì‹¤í–‰í•©ë‹ˆë‹¤
						for (var i = 0; i < obj.length; i++) {
							
							// ì½œë°±í•¨ìˆ˜ ì•ˆì—ì„  ë°˜ë³µë¬¸ ë³€ìˆ˜ì‚¬ìš©ì´ ì•ˆë¨. ê·¸ë˜ì„œ ë”°ë¡œ ë³€ìˆ˜ì„ ì–¸ì„ í•´ì¤€ë‹¤.
							let bizName = i;
							// ê° ì£¼ì†Œì— ëŒ€í•´ geocoder.addressSearch í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤
							geocoder.addressSearch(obj[bizName].bizAddr, function(result, status) {
								
								// ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´ 
								if (status === kakao.maps.services.Status.OK) {
					
									var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
									console.log(obj[bizName].bizNm)
									
									// ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
									var marker = new kakao.maps.Marker({
										map : map,
										position : coords
									});
					
									// ì¸í¬ìœˆë„ìš°ë¡œ ì¥ì†Œì— ëŒ€í•œ ì„¤ëª…ì„ í‘œì‹œí•©ë‹ˆë‹¤ --ì™œ ë˜‘ê°™ì€ê²Œ ë‚˜ì˜¤ëŠ”ê²ƒì¸ê°€.. ië¡œ í•˜ë©´ ì™œ undefineì´ ë‚˜ì˜¤ëŠ”ê²ƒì¸ê°€..
									var infowindow = new kakao.maps.InfoWindow({
											content : '<div style="width:150px;text-align:center;padding:6px 0;">'+obj[bizName].bizNm+'</div>'
										});
									infowindow.open(map, marker);
					
									// ì§€ë„ì˜ ì¤‘ì‹¬ì„ ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤
									map.setCenter(coords);
									
								}
							});
						}
					},
					error : function(error) {
						console.log(error)
					}

				});
		
		</script>

	</div>
	<!-- íƒ€ì„ë¦¬í”„ divë -->
</body>
</html>