<!DOCTYPE html>
<html class="no-js" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{biz/slide/slide}">

<body>
	<div layout:fragment="Bizcontent">
		<div class="container">
			<div class="message-box box-shadow white-bg">
					<div class="row">
						<div class="col-lg-12 mb-30" style="display: flex; align-items: center;">
						  <h4 class="blog-section-title border-left" style="margin-right: 10px;">ë©”ë‰´ ê´€ë¦¬</h4>
						  <p style="margin: 0;">ë©”ë‰´ëŠ” 10ê°œê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
						  <div id="inputBtnDiv"></div>
						</div>
					    <div  id="menuTrgt">
					    </div>
					</div>
			</div>
		</div>
		
		
		<script type="text/javascript">
		//=================================
		//â¤ï¸ ì „ì—­ë³€ìˆ˜ ì„ ì–¸ë¶€
		var menuCnt = 0;
		
		//=================================
		//â¤ï¸ DOM í•¨ìˆ˜
		$(function(){
			getMenuAjax();
		})
		
		//=================================
		//â¤ï¸ ê¸°ì¡´ë©”ë‰´ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ajax
		function getMenuAjax(){
			$.ajax({
				url:'/biz/getMenuAjax',
				type:'get',
				contentType: 'application/json',
				dataType: 'json',
				success:function(result){
					result.forEach((menu)=>{
						setExistMenu(menu);
					})
						isInsertOk();
				},
				error:function(err){
					alert("[ê¸°ì¡´ë©”ë‰´ ë¡œë“œ ì‹¤íŒ¨] ê¸°ì¡´ë©”ë‰´ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. ("+err+")")
				}
			})
		}
		
		//=================================
		//â¤ï¸ ê¸°ì¡´ë©”ë‰´ ê·¸ë¦¬ê¸°
		function setExistMenu(menu){
			menuCnt++;
			console.log(menu);
			let atchId = menu.atchId
			$("#menuTrgt").append(`
					
					<div  class="message-box box-shadow white-bg p-4" id="deltrgt${menu.menuNo}">
					<h6 class="blog-section-title mb-30">ë©”ë‰´${menuCnt}</h6>
					<form id="menuFrm${menu.menuNo}" method="post" onsubmit="return false">
					<table id="${menuCnt}tbl">
				        <tr>
				            <td rowspan="4">
				               <label for="menuImg${menu.menuNo}"><img class="mb-20" style="height: 100px; border:2px solid #FCD052" src="${menu.atchId}" id="imgBox${menu.menuNo}"></label>
				               <input type="file" style="width: 80px; margin-left: 10px;" id="menuImg${menu.menuNo}" disabled="true">
				            </td>
				            <td></td>
				        </tr>
				        <tr>
				            <td>
				               <label for="menuNm${menu.menuNo}">ë©”ë‰´ëª…
				               <input type="text" id="menuNm${menu.menuNo}" value="${menu.menuNm}" readonly="true" name="menuNm"></label>
				            </td>
				            <td rowspan="4">
				               <button class="submit-btn-1 mt-30 btn-hover-1" type="button" id="editBtn${menu.menuNo}" onclick="editMenu(${menu.menuNo},menuCnt)">ìˆ˜ì •</button>
				               <button class="submit-btn-1 mt-30 btn-hover-1" type="button" id="delBtn${menu.menuNo}" onclick="delMenu(${menu.menuNo})">ì‚­ì œ</button>
				            </td>
				        </tr>
				        <tr>
				            <td>
				                <label for="menuPrc${menu.menuNo}">ê°€ê²©
				                <input type="text" id="menuPrc${menu.menuNo}" value="${menu.menuPrc}" readonly="true" 
				                		oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\\..*)\\./g, '$1');" name="menuPrc"></label>
				            </td>
				            <td></td>
				        </tr>
				        <tr>
				            <td>
				                <label for="menuCn${menuCnt}">í•œì¤„ì„¤ëª…
				                <input type="text" id="menuCn${menuCnt}" value="${menu.menuCn}" readonly="true" name="menuCn"></label>
				            </td>
				            <td></td>
				        </tr>
				    </table>
				    <input type="hidden" name="menuNo" value="${menu.menuNo}">
				    </form>
			    </div>	
					
					`)
		}
		
		//=================================
		//â¤ï¸ ë©”ë‰´ ìˆ˜ì •í•˜ê¸°
		function editMenu(menuNo, idInfo){
			$("#editBtn"+menuNo).removeAttr("onclick").attr("onclick","menuEdixAjax("+menuNo+")").text("ì €ì¥");
			
			$("#menuNm"+menuNo).attr("readonly",false).focus();
			$("#menuPrc"+menuNo).attr("readonly",false);
			$("#menuCn"+menuNo).attr("readonly",false);
			$("#menuImg"+menuNo).attr("disabled",false);
			console.log(menuNo);
		}
		
		//=================================
		//â¤ï¸ ë©”ë‰´ ìˆ˜ì • ajax
		function menuEdixAjax(menuNo){
			if(editChk(menuNo)){
				if(confirm("ì…ë ¥í•˜ì‹  ì •ë³´ë¡œ ë©”ë‰´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
					
					if(fileUploadAjax())
					var formData = new FormData($("#menuFrm"+menuNo)[0]);
					$.ajax({	
						url : "/biz/menuEdixAjax",
						type : "POST",
						data : formData,
						processData : false,
						contentType : false,
						success : function(result) {
							console.log(result)
							alert("[ìˆ˜ì •ì™„ë£Œ] ë©”ë‰´ ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ :D");
						},
						error : function(err){
							alert("[ìˆ˜ì •ì‹¤íŒ¨] ë©”ë‰´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. :(");
						}
					});	
				}
				
			}
		}
		
		//=================================
		//â¤ï¸ ë©”ë‰´ ìˆ˜ì • ì „ ìœ íš¨ì„± ê²€ì‚¬
		function editChk(menuNo){
			if($("#menuNm"+menuNo).val()==""){
				alert("ë©”ë‰´ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”ğŸ™‚");
				$("#menuNm"+menuNo).focus();
				return false;
			}else if($("#menuPrc"+menuNo).val()==""){
				alert("ë©”ë‰´ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”ğŸ™‚");
				$("#menuPrc"+menuNo).focus();
				return false;
			}else if($("#menuCn"+menuNo).val()==""){
				alert("ë©”ë‰´ í•œì¤„ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”ğŸ™‚");
				$("#menuCn"+menuNo).focus();
				return false;
			}else if($("#menuImg"+menuNo).val()==""){
				return (confirm("ì‚¬ì§„ì€ ë³€ê²½í•˜ì§€ ì•Šìœ¼ì‹œëŠ” ê±´ê°€ìš”ğŸ¤”?"));
			}else if($("#menuImg"+menuNo).val()!=""){
				return true;				
			}
		}
		
		function delMenu(menuNo){			
			if(confirm("ë©”ë‰´ ì‚­ì œ ì‹œ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
				$.ajax({
					url:'/biz/menuDelAjax/'+menuNo,
					type:'get',
					success:function(result){
						alert("ì‚­ì œì„±ê³µ");
						$("#deltrgt"+menuNo).remove();
						menuCnt--;
						isInsertOk();
					},error:function(err){
						alert("ì‚­ì œì‹¤íŒ¨")
					}
				})
			}
		}
		
		function isInsertOk(){
			console.log(menuCnt);
			if(menuCnt<=10 && $("#inputBtnDiv").children().length==0){
				$("#inputBtnDiv").append(`
						<button type="button" onclick="insertMenu()" class="submit-btn-1 ml-30 btn-hover-1">ë©”ë‰´ì¶”ê°€</button>
						`)
			}
		}
		
		function insertMenu(){
			location='/biz/insertMenu';
		}
		</script>
	</div>
</body>

</html>