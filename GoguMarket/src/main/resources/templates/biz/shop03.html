<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://ultraq.net/thymeleaf/layout"
	layout:decorate="~{biz/slide/slide}">

<head>
	<meta charset="UTF-8">
	<title>ê°€ê²Œ ì •ë³´ ë“±ë¡í•˜ê¸°</title>
	<script src="js/vendor/jquery-3.6.0.min.js"></script>
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>

<body>
	<div layout:fragment="Bizcontent">
		<div class="message-box-section mb-80">
			<div class="container">
				<div class="message-box box-shadow white-bg">
						<div class="row">
							<div class="col-lg-12">
								<h4 class="blog-section-title border-left mb-30">ê°€ê²Œ ì •ë³´ë“±ë¡ í•˜ê¸°</h4>
							</div>
							<div class="userTable">
								<!-- â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  ì£¼ì˜1 â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  -->
								<form id="uForm" method="post" enctype="multipart/form-data"
									onsubmit="return false">
									<!-- â– â– â†‘ form id ìƒˆë¡œ ì§€ì •í•´ì£¼ì„¸ìš” â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  -->
									<div class="row">
										<div class="col-lg-12">
											<h4 class="blog-section-title border-left mb-30">ê°€ê²Œ ì •ë³´ ìˆ˜ì •</h4>
										</div>
									</div>
									<!-- â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  ì£¼ì˜2 â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  -->
									<div class="col-lg-10" id="inputFile">
										<label for="files">í”„ë¡œí•„ ì‚¬ì§„<span> *</span></label>
										<input type="file" id="files" placeholder="ì²¨ë¶€íŒŒì¼" multiple="multiple">
										<br>
										<span id="fileErrMsg"></span>
										<div id="fileList">
											<div id="uploadFileList" data-placeholder='ğŸ¶ì²¨ë¶€íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤ğŸŒ³'
												class="message-box box-shadow white-bg">
											</div>
										</div>
									</div>
									<!-- â– â– â– â†‘ ê±´ë“œë¦¬ë©´ ì£½ìŒë¿.â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  -->

									<!--<div class="col-lg-10 mb-10">
										<label for="cate">ì¹´í…Œê³ ë¦¬<span> *</span></label>
										<select name="cate" id="cate">
											<option value="" disabled selected>ì„ íƒ</option>
											<option th:each="ct : ${category}" th:text="${ct.commonNm}"
												th:value="${ct.commonDetailCode}"></option>
										</select>
										<span id="ctgryErrMsg"></span>
										<input type="hidden" name="ctgry" id="ctgry" placeholder="ì¹´í…Œê³ ë¦¬">
									</div>-->
									<div class="col-lg-10 ">
										<label for="bizNm">ê°€ê²Œëª…<span> *</span></label>
										<input type="text" name="bizNm" id="bizNm" th:value="${updateBizMem.bizNm}" readonly="readonly">
									</div>
									<div class="col-lg-10">
										<label for="cn">ê°€ê²Œì„¤ëª…<span> *</span></label>
										<textarea class="custom-textarea" name="cn" id="cn"
											placeholder="ê°„ë‹¨í•œ ê°€ê²Œ ì„¤ëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”. :)"></textarea>
									</div>
									<div class="col-lg-10">
										<label for="bgngTm">ì˜¤í”ˆì‹œê°„</label>
										<input class="custom-textarea" name="bgngTm" id="bgngTm"></input>~
										<input class="custom-textarea" name="endTm" id="endTm"></input>
										<label for="endTm">ë§ˆê°ì‹œê°„</label>
									</div>
									
									<div class="col-lg-10">
										<label for="ddlnYmd">ê²½ë§¤ì¢…ë£Œì¼<span> *</span></label>
										<input type="date" name="ddlnYmd" id="ddlnYmd">
									</div>
									<button class="submit-btn-1 mt-30 btn-hover-1" type="reset">ì·¨ì†Œ</button>
									<button class="submit-btn-1 mt-30 btn-hover-1" onclick="goList()">ëª©ë¡</button>
									<input class="submit-btn-1 mt-30  btn-hover-1" type="submit" id="btnSave"
										role="button" value="ë“±ë¡í•˜ê¸°">
								</form>
							</div>
							<div class="col-lg-12">

								<input class="submit-btn-1 mt-30 btn-hover-1" type="submit" id="btn"
									onclick="location.href='/biz/shop03'" value="ìˆ˜ì •í•˜ê¸°">
								&nbsp;&nbsp;
								<button class="submit-btn-1 mt-30 btn-hover-1" type="reset">ì·¨ì†Œ</button>
							</div>
						</div>
				</div>
			</div>
		</div>

		<script th:inline="javascript">
			//==============================================================================
			//âœ… DOM ê·¸ë¦¬ë©´ì„œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (== document.onload())
			$(function () {
				$("#files").on("change", function (e) {
					$("#fileErrMsg").text("")
					inputFile(e);
				});
				console.log(typeof ($(".ctgry")))

				$("#cate").on("change", function () {
					$("#ctgryErrMsg").text("")
				})

				$("#btnSave").on("click", function () {
					submitForm();
				});
			});

			//==============================================================================
			//ğŸ“Œ	 ê³µí†µìœ¼ë¡œ ì“°ì¼ ë³€ìˆ˜ ì„ ì–¸(ì „ì—­ë³€ìˆ˜ var)
			var fileCount = 0; //í˜„ì¬ ì²¨ë¶€íŒŒì¼ ê°œìˆ˜
			var totalCount = 1; // ì²¨ë¶€ ê°€ëŠ¥í•œ íŒŒì¼ ê°œìˆ˜
			var fileNum = 0; //ì²¨ë¶€íŒŒì¼ ì¸ë±ìŠ¤
			var inputFileList = new Array(); // insert íŒŒì¼ ë°°ì—´
			var deleteFileList = new Array(); // delete íŒŒì¼ ë°°ì—´
			var isSubmitOk = true;

			var img_style = 'width:100px;height:100px;z-index:none'; // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ì†ì„±

			//==============================================================================
			//âœ… input ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
			function inputFile(e) {
				var files = e.target.files;
				var filesArr = Array.prototype.slice.call(files);

				if (fileCount + filesArr.length > totalCount) {
					alert('íŒŒì¼ì€ ìµœëŒ€ ' + totalCount + 'ê°œê¹Œì§€ ì—…ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
					return;
				} else {
					fileCount = fileCount + filesArr.length;
				}

				filesArr.forEach(function (f) {
					var reader = new FileReader();
					reader.onload = function (e) {
						inputFileList.push(f);
						$('#uploadFileList').append(
							`<img style=${img_style} src=${e.target.result}
											id=file${fileNum} onclick=fileDelete('file${fileNum}') class=m-1>`
						)
						fileNum++;
					};
					reader.readAsDataURL(f);
				});
				$("#files").val("");
			}

			//==============================================================================
			//âœ… í™”ë©´/ë°°ì—´ì—ì„œ delete ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜			
			function fileDelete(fileNum) {
				var no = fileNum.replace(/[^0-9]/g, "");
				inputFileList[no].is_delete = true;
				$('#' + fileNum).remove();
				fileCount--;
				if (fileCount == 0) {
					$("#fileErrMsg").text("âœ… ìƒí’ˆ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.")
					isSubmitOk = false;
				}
			}

			//==============================================================================
			//âœ… í™”ë©´/ë°°ì—´ì—ì„œ delete ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
			function submitForm() {
				// ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ > hidden input valueë¡œ ë„£ê¸°
				var ctgry = $("#cate option:selected").val();
				$("#ctgry").val(ctgry);

				console.log("ë‹´ì€ ctgry =>" + ctgry)


				//submit ì „ ì²´í¬í•˜ê¸°
				if (submitCheck()) {
					// â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  ì£¼ì˜3 â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– 
					var formData = new FormData($("#uForm")[0]);
					// â– â– â– â†‘ ì£¼ì˜1ì—ì„œ ì§€ì •í•œ í¼ id ì ì–´ì£¼ì„¸ìš” â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– 

					formData.append("deleteFiles", deleteFileList);

					for (var i = 0; i < inputFileList.length; i++) {
						if (!inputFileList[i].is_delete) {
							formData.append("files", inputFileList[i]);
						}
					}
					// â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–  ì£¼ì˜4 â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– 
					$.ajax({
						url: "/biz/shopUpdateSubmit",
						type: "POST",
						data: formData,
						processData: false,
						contentType: false,
						success: function (result) {
							console.log(result)
							alert("[ì‘ì„± ì™„ë£Œ] ê°€ê²Œ í”„ë¡œí•„ ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. :D");
							location.href = "/goguma/auctList";

						},
						error: function (err) {
							alert("[ì‘ì„± ì‹¤íŒ¨] ê°€ê²Œ í”„ë¡œí•„ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. :(");
						}
					});
					// â– â– â– â†‘ â‘ url â‘¡alert ë‚´ìš© â‘¢success > location.href ê²½ë¡œ ë°”ê¿”ì£¼ì„¸ìš” â– â– â– â– â– â– â– â– â– â– â– â– â– â– 
				}
			}
			//==============================================================================
			//âœ… í™”ë©´/ë°°ì—´ì—ì„œ delete ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
			function submitCheck() {
				//1. íŒŒì¼ ì—…ë¡œë“œ ì—¬ë¶€
				if (inputFileList.length == 0) {
					$("#fileErrMsg").text("âœ… ìƒí’ˆ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.")
					isSubmitOk = false;
				}

				//2. ì¹´í…Œê³ ë¦¬ ì„ íƒ ì—¬ë¶€
				else if ($("#ctgry").val() == "") {
					$("#ctgryErrMsg").text("âœ… ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.")
					isSubmitOk = false;
				}

				//3. ê¸€ì œëª© ì‘ì„± ì—¬ë¶€
				else if ($("#auctTtl").val() == "") {
					$("#auctTtl").focus();
					isSubmitOk = false;
				}

				//4. ê¸€ë‚´ìš© ì‘ì„± ì—¬ë¶€
				else if ($("#auctCn").val() == "") {
					$("#auctCn").focus();
					isSubmitOk = false;
				}

				//5. ìµœì†Œê°€ê²© ì‘ì„± ì—¬ë¶€
				else if ($("#lowPrc").val() == "") {
					$("#lowPrc").focus();
					isSubmitOk = false;

					//6. ë°ë“œë¼ì¸ ì„¤ì • ì—¬ë¶€
				} else if ($("#ddlnYmd").val() == "") {
					$("#ddlnYmd").focus();
					isSubmitOk = false;
				} else if ($("#quickPrc").val() == "") {
					$("#quickPrc").val(Number(0))
				} else {
					isSubmitOk = true;
				}

				return isSubmitOk;
			}

			//==============================================================================
			//âœ… (ìˆ˜ì •/ì‚­ì œì—ì„œ ì‚¬ìš©) ê¸°ì¡´ dbì—ì„œ ì‚­ì œí•  íŒŒì¼ë“¤ì„ ë°°ì—´ì— ë‹´ì•„ì„œ ë³´ë‚´ëŠ” í•¨ìˆ˜
			function deleteFile(elem) {
				// 				console.log(elem.value);
				// 				$(elem).parent().remove();
				// 				if (!deleteFileList.includes(elem.value)) {
				// 					deleteFileList.push(elem.value);
				// 					}
			}

			function goList() {
				location.href = "/goguma/auctList";
			}
		</script>
	</div>
</body>

</html>