<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goguma.mem.mapper.PointMapper">

	<!-- ‚ö†Ô∏è‚ö†Ô∏è ÏûêÎèôÏ†ïÎ†¨(ctrl + F) Í∏àÏßÄ ‚ö†Ô∏è‚ö†Ô∏è-->
	<!-- ‚ù§ Ìè¨Ïù∏Ìä∏ Ï†ÅÎ¶Ω -->
	<insert id="insertPoint"
		parameterType="com.goguma.mem.vo.PointVO">
		<selectKey keyProperty="pointNo" resultType="int"
			order="BEFORE">
			SELECT CASE WHEN MAX(point_no) IS NULL 
						THEN 1 
				   		ELSE MAX(point_no) + 1 
				   END as pointNo
			FROM point
		</selectKey>
		INSERT INTO POINT 
		VALUES(#{pointNo}, #{userId}, #{point}, #{pointMthd}, CURRENT_DATE, null)
	</insert>
	
	
	<!-- ‚ù§ Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö© -->
	<insert id="insertUsedPoint"
		parameterType="com.goguma.mem.vo.PointVO">
		<selectKey keyProperty="pointNo" resultType="int"
			order="BEFORE">
			SELECT CASE WHEN MAX(point_no) IS NULL 
						THEN 1 
				   		ELSE MAX(point_no) + 1 
				   END as pointNo
			FROM point
		</selectKey>
		INSERT INTO POINT 
		VALUES(#{pointNo}, #{userId}, -200, 'ÎÅåÏñ¥Ïò¨Î¶¨Í∏∞', null, CURRENT_DATE)
	</insert>
	
	<!-- ‚ö†Ô∏è‚ö†Ô∏è ÏûêÎèôÏ†ïÎ†¨(ctrl + F) Í∏àÏßÄ ‚ö†Ô∏è‚ö†Ô∏è-->
	<!-- ‚ù§ Ìè¨Ïù∏Ìä∏ Ï†ÑÏ≤¥Ï°∞Ìöå (Í¥ÄÎ¶¨ÏûêÏö©) -->
	<select id="selectPointList"
		resultType="com.goguma.mem.vo.PointVO">
		SELECT * FROM POINT
	</select>
	
	<!-- ‚ù§ ÌäπÏ†ï Ïú†Ï†Ä Î≥¥Ïú† Ìè¨Ïù∏Ìä∏ Ï°∞Ìöå (Ïú†Ï†ÄÏö©) -->
	<select id="selectPointListForUser" parameterType="String"
		resultType="com.goguma.mem.vo.PointVO">
		SELECT * FROM POINT
		WHERE user_id = #{userId}
		ORDER BY point_no DESC
	</select>

	<!-- üíô ÌäπÏ†ï Ïú†Ï†Ä Î≥¥Ïú† Ìè¨Ïù∏Ìä∏ Ï°∞Ìöå (ÌéòÏù¥Ïßï, Ïπ¥ÌÖåÍ≥†Î¶¨) -->
	<select id="selectPointListForUserPaging" 
			parameterType="com.goguma.mem.vo.PointVO" 
			resultType="com.goguma.mem.vo.PointVO">
		SELECT * 
		FROM (SELECT ROWNUM rn, A.* 
		      FROM(SELECT p.*
		           FROM point p) A
	<![CDATA[ 
		      WHERE ROWNUM <= #{last} ) B
		WHERE rn >= #{first}
	]]>	
		AND user_id = #{userId}
		AND point_mthd IN ('ÎÅåÏñ¥Ïò¨Î¶¨Í∏∞'
		<if test="searchPoint != null">, '#{searchPoint}'</if>
		)
		ORDER BY point_no DESC
	</select>
</mapper>